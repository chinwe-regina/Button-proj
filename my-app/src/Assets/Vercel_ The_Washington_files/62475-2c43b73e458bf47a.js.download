"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[62475],{417990:function(e,t,n){function r(e){let t=new URLSearchParams;for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.append(n,e[n]??"");return t.toString()}function o(e){let t=new URLSearchParams(e),n={};for(let[e,r]of t.entries())n[e]=r||void 0;return n}function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"&",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"=",r=[];for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t)){let o=e[t];if(Array.isArray(o))for(let e of o)r.push(`${encodeURIComponent(t)}${n}${encodeURIComponent(e.toString())}`);else void 0!==o&&r.push(`${encodeURIComponent(t)}${n}${encodeURIComponent(o.toString())}`)}return r.join(t)}n.d(t,{Jx:function(){return o},Pz:function(){return i},cv:function(){return r}})},590799:function(e,t,n){n.d(t,{D:function(){return a}});var r=n(595376),o=n(417990),i=n(58363),l=n(121123);async function a(e,t){var n;let{mode:a}=t,u=r.daumtools.userAgent(),c=null==u?void 0:null===(n=u.browser)||void 0===n?void 0:n.name,s=`Website${c?` (${c.charAt(0).toUpperCase()+c.slice(1)})`:""}`,g=(0,o.Pz)({mode:a});return(0,i.I)(`${l.OK}?${g}`,{method:"POST",body:JSON.stringify({email:e,tokenName:s}),throwOnHTTPError:!0})}},898337:function(e,t,n){n.d(t,{Z:function(){return a}});var r=n(417990),o=n(58363),i=n(520860),l=n(121123);async function a(e){let{email:t,token:n,ssoToken:a}=e,u=(0,r.Pz)({email:t,token:n,t:Date.now(),...a&&{ssoToken:a}});try{return await (0,o.I)(`${l.OK}/verify?${u}`,{throwOnHTTPError:!0}),delete globalThis.__loggedIn,!0}catch(e){if((0,i.f)(e)&&403===e.status)throw e;return!1}}},520860:function(e,t,n){n.d(t,{f:function(){return o}});var r=n(69282);let o=e=>(0,r.x)(e)&&"code"in e},219757:function(e,t,n){n.d(t,{Z:function(){return r}});function r(e){return new Promise(t=>{setTimeout(t,e)})}},648601:function(e,t,n){n.d(t,{P:function(){return r},Y:function(){return o}});let r={PLACEHOLDER:"placeholder",INPUT:"input",LOADING_EMAIL:"loading-email",LOADING_GITHUB:"loading-github",LOADING_GITLAB:"loading-gitlab",LOADING_BITBUCKET:"loading-bitbucket",LOADING_SAML:"loading-saml",VERIFYING_EMAIL:"verifying",SUCCESS:"success",ERROR:"error",ACCOUNT_NEEDS_VERIFY_SMS:"account-needs-verify",SELF_SERVE_VERIFICATION:"self-serve-verification"},o=[r.LOADING_GITHUB,r.LOADING_GITLAB,r.LOADING_BITBUCKET,r.LOADING_SAML,r.LOADING_EMAIL]},562475:function(e,t,n){n.d(t,{PM:function(){return C.P},YN:function(){return C.Y},aC:function(){return T}});var r=n(652983),o=n(369487),i=n(403873),l=n(317773),a=n(628987),u=n(490720),c=n.n(u),s=n(684874),g=n(590799),d=n(898337),f=n(219757),h=n(869384),p=n(65475),S=n(517659),E=n(978347),I=n(697402),P=n(167593),v=n(172129),w=n(71299),R=n(121123),L=n(452134),O=n(520860),m=n(465972),A=n(58363),N=n(891828),C=n(648601);function b(e,t){return{...e,...t}}let _=()=>{},y=()=>`${window.location.origin}/oauth/git`,T=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"login",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},[n,u]=(0,r.useReducer)(b,{loginState:C.P.PLACEHOLDER,loginError:null,isLoading:!0,...t.defaultState}),T=(0,r.useRef)(null),$=(0,l.t)(),k=(0,a.useSearchParams)(),G=(0,a.usePathname)(),D=(0,h.Z)(null==k?void 0:k.get("next")),x=(0,r.useRef)(_),M=(0,r.useRef)(t);M.current=t;let{data:H}=(0,w.a)(),B=null==H?void 0:H.user;(0,r.useEffect)(()=>()=>{T.current&&T.current.close(),T.current=null},[]),(0,r.useEffect)(()=>{let e=n.loginState===C.P.PLACEHOLDER||C.Y.includes(n.loginState);n.isLoading&&!e&&u({isLoading:e})},[n.loginState,n.isLoading]),(0,r.useEffect)(()=>{if(G&&(null==k?void 0:k.get("next"))&&!(0,h.Z)(k.get("next"))){let e=new URLSearchParams(k);e.delete("next"),$.replace(`${G}?${e.toString()}`,void 0,{shallow:!0})}},[G,k,$]),(0,r.useEffect)(()=>{if(!T.current&&(!("isReady"in $)||$.isReady)){if((null==k?void 0:k.get("loginType"))==="saml"&&"1"===k.get("confirmed")){u({loginState:C.P.LOADING_SAML});let e=k.get("teamSlug"),t=new URLSearchParams(k);e&&!D&&t.set("next",`/${e}`);let n=`${y()}?${t.toString()}`;$.push(n);return}if((null==k?void 0:k.get("origin"))==="saml"&&"/login"===window.location.pathname){u({loginState:C.P.LOADING_SAML}),$.push(`/teams/connect?${k.toString()}`);return}u({loginState:C.P.INPUT})}},[k,$,D]),(0,r.useEffect)(()=>{let e=null==k?void 0:k.get("loginError");e&&u({loginState:C.P.ERROR,loginError:(0,L.j)(e)})},[k]);let Y=(0,r.useCallback)(async r=>{var o,i,l,a,c;if(!T.current||r.source!==T.current.popup||"object"!=typeof r.data||!r.data)return;let{source:g,close:d,success:f,next:h,...p}=r.data;if("vercel-verify-auth"!==g)return;let S=null===(i=T.current)||void 0===i?void 0:null===(o=i.popup)||void 0===o?void 0:o.location.search,E=S?new URLSearchParams(S):null;if(d){T.current.close(!0),T.current=null,E&&E.has("origin")&&"saml"===E.get("origin")&&$.push(`/teams/connect?${E.toString()}`);return}if(p.loginError&&(T.current.close(!0),T.current=null),u(p),f){let r=E?E.get("next"):null,o=r?decodeURIComponent(r):null;if(null===(l=T.current)||void 0===l||l.close(!0),T.current=null,"signup"===e)try{s.co.track(s.s6.CREATE_ACCOUNT),s.co.track(s.s6.SIGN_UP)}catch(e){}else if("login"===e)try{s.co.track(s.s6.LOGIN)}catch(e){}if(delete globalThis.__loggedIn,await (0,v.Hu)(),M.current.onAuthenticated)M.current.onAuthenticated();else{let r=h||o||D||"signup"!==e&&"/dashboard";if(r){if("signup"===e&&r.startsWith("/turborepo"))try{let e=await (0,m.P)();e.user&&await U(e.user.email)}catch(e){console.error(e)}t.skipDefaultRedirectOnSignup||(window.location.href=r)}else["loading-github","loading-gitlab","loading-bitbucket"].includes(n.loginState)&&await (0,I.xb)({provider:n.loginState.split("-")[1],namespaceId:null}),window.location.href="/new"}}else null===(a=(c=M.current).onError)||void 0===a||a.call(c)},[e,D,t.skipDefaultRedirectOnSignup,n.loginState,$]);function F(n,r){var o,i;let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{next:a,callbackParams:c,...g}=l,d=t=>{let o=y()+(0,S.c)({next:t?a??D:a,...c}),i="saml"===n.toLowerCase()?R.fr:R.OK;return`${i}${r}${(0,S.c)({mode:e,next:o,...g})}`};"login"===e?s.co.track(s.s6.LOGIN,{source:`${(0,E.F)(n)} login`}):s.co.track(s.s6.SIGN_UP),u({loginError:null}),t.useRedirect?(u({loginState:C.P[`LOADING_${n.toUpperCase()}`]}),window.location.href=d(!0)):(o=d(!1),i=d(!0),T.current=new p.Z({id:"vercel-login-popup",url:o,callbacks:{onOpen:()=>{u({loginState:C.P[`LOADING_${n.toUpperCase()}`]})},onAbort:()=>{T.current=null,u({loginState:C.P.INPUT})},onClose:()=>{T.current=null,u({loginState:C.P.INPUT})},onBlocked:()=>{T.current=null,u({loginState:C.P[`LOADING_${n.toUpperCase()}`]}),window.location.href=i}}}),T.current.open())}function W(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};F(e,"github"===e?"/login-with-github":`/${e}/connect`,t)}return(0,r.useEffect)(()=>(window.addEventListener("message",Y),()=>{window.removeEventListener("message",Y)}),[Y]),{saveInput:function(e,t){n.loginState===C.P.ERROR?u({[e]:t,loginError:null}):u({[e]:t})},cancelLogin:function(){if(x.current(),u({loginState:C.P.INPUT,loginError:null}),t.skipRouterRedirectOnCancel||!G)return;let e=new URLSearchParams;D&&e.set("next",D);let n=null==k?void 0:k.get("isRequestAccess");n&&e.set("isRequestAccess",n);let r=null==k?void 0:k.get("teamName");r&&e.set("teamName",r),$.replace(`${G}?${e.toString()}`)},loginWithEmail:async function(){var r;let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{email:a,teamSlug:h}=n,p=!1;x.current(),x.current=()=>p=!0;try{u({loginState:C.P.LOADING_EMAIL,loginError:null});let n=await (0,g.D)(a,{mode:e});u({loginState:C.P.VERIFYING_EMAIL,email:a,securityCode:n.securityCode});for(;;){if(p)return;if(await (0,d.Z)({email:a,token:n.token,ssoToken:null===(r=l.callbackParams)||void 0===r?void 0:r.ssoToken}))break;await (0,f.Z)(2500)}if("signup"===e)try{s.co.track(s.s6.CREATE_ACCOUNT),s.co.track(s.s6.SIGN_UP)}catch(e){}else if("login"===e)try{s.co.track(s.s6.LOGIN)}catch(e){}await (0,v.Hu)();let o=l.patchedSignupAccountName;"signup"===e&&o&&o.length>0&&await (0,P.E)(()=>(0,A.I)(R.zh,{method:"PATCH",body:{name:c()(o)}}));let i=(0,N.bR)(),S=l.next??D??(h?`/${h}`:null)??(i?`/${i}`:null)??(B?`/${B.username}`:"/dashboard");if(S){if("signup"===e&&S.startsWith("/turborepo")&&a)try{await U(a)}catch(e){console.error(e)}"signup"!==e||t.skipDefaultRedirectOnSignup||(S="/new?onboarding=true"),u({loginState:C.P.SUCCESS}),t.skipDefaultRedirectOnSignup||setTimeout(()=>{window.location.href=new URL(S,window.location.href).href},300);return}u({loginState:C.P.SUCCESS})}catch(e){if(p)return;(0,O.f)(e)&&(e.redirect||(null==e?void 0:e.code)===o.aU.ACCOUNT_NEEDS_VERIFY)?n.email&&u({loginState:C.P.ACCOUNT_NEEDS_VERIFY_SMS}):u({loginState:C.P.ERROR,loginError:(0,i.SC)(e)})}},loginWithSAML:async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{teamSlug:r}=n;if(!r)return u({loginState:C.P.ERROR,loginError:{code:"",message:"Please enter a Team slug."}});F("saml","",{next:D||`/${r}`,...t,teamId:r,mode:e})},loginWithGitHub:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return W("github",e)},loginWithGitLab:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return W("gitlab",e)},loginWithBitbucket:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return W("bitbucket",e)},loginWithGit:W,state:n,dispatch:u,mode:e}};async function U(e){try{let t=await fetch("/api/turborepo-signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})});if(!t.ok)throw Error("An unexpected error. Please try again later.")}catch(e){console.error(e)}}}}]);